pipeline {
    agent { label 'jenkins_slave' }
    triggers {
        githubPush() // Triggered by GitHub push webhook
    }

    environment {
        DEPLOY_DIR = 'C:\\nginx\\html' // Path to actual running NGINX HTML dir
        NGINX_WORKSPACE_DIR = 'C:\\ProgramData\\Jenkins\\.jenkins\\workspace\\testing\\nginx-1.28.0'
    }

    stages {
        stage('Clone Repository') {
            steps {
                git branch: 'main', url: 'https://github.com/vaibhav21soni/jenkins.git'
            }
        }

        stage('Manage NGINX from Workspace') {
            steps {
                bat """
                cd "${env.NGINX_WORKSPACE_DIR}"
                echo Starting nginx from workspace...
                start nginx
                timeout /t 2 > NUL
                echo Stopping nginx from workspace...
                nginx -s stop
                timeout /t 2 > NUL
                echo Restarting nginx from workspace...
                start nginx
                nginx -s reload
                echo NGINX restarted and reloaded.
                """
            }
        }

        stage('Deploy index.html to actual NGINX html') {
            steps {
                // Ensure deploy directory exists and copy index.html
                bat """
                if not exist "${env.DEPLOY_DIR}" (
                    mkdir "${env.DEPLOY_DIR}"
                )
                copy /Y index.html "${env.DEPLOY_DIR}\\index.html"
                echo Deployment completed successfully
